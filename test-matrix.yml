# Some content of this file is generated.

trigger:
  branches:
    exclude:
    - '*'

variables:
- template: ${{ variables.Pipeline.Workspace }}/.azure-pipelines/templates/variables.yml

jobs:
- job: getPythonVersion
  displayName: "get Python Version"
  pool:
    name: 'pool-ubuntu-2004'
  steps:
    - task: UsePythonVersion@0
      displayName: 'Use Python 3.10'
      inputs:
        versionSpec: '3.10'
    - bash: |
        #!/usr/bin/env bash
        set -ev

        cat >auto_commit.py <<EOL
        #!/usr/bin/env python


        def main():
            pythonVersion = ['3.8', '3.9', '3.10']
            print('##vso[task.setvariable variable=pythonVersion;isoutput=true]' + pythonVersion)


        if __name__ == '__main__':
            main()
        EOL
        python auto_commit.py
      name: CustomParas
      displayName: 'get Python Version'
      env:
        ADO_PULL_REQUEST_LATEST_COMMIT: HEAD
        ADO_PULL_REQUEST_TARGET_BRANCH: $(System.PullRequest.TargetBranch)

- job: TestMatrix
  pool:
    name: ${{ variables.ubuntu_pool }}
  displayName: Test Matrix
  variables:
    PythonVersion: $[ dependencies.getPythonVersion.outputs['CustomParas.pythonVersion'] ]
  condition: and(succeeded(), ne(variables.PythonVersion, 'false'))
  timeoutInMinutes: 0
#  strategy:
#    matrix:
#      ${{ each version in variables.PythonVersion }}:
#        ${{version}}:
#          python.version: ${{version}}
  steps:
    - bash: |
        #!/bin/bash
        python -V
        echo ${{ variables.PythonVersion }}